---
import SEO from '@components/SEO.astro';
import Header from '@components/Header.astro';
import LeftSidebar from '@components/LeftSidebar.astro';
import MobileNav from '@components/MobileNav.astro';
import '@styles/global.css';

export interface Props {
    title: string;
    description: string;
    image?: string;
    article?: boolean;
    publishedTime?: string;
    tags?: string[];
}

const { title, description, image, article = false, publishedTime, tags } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="en" class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="sitemap" href="sitemap-index.xml" />
        <meta name="generator" content={Astro.generator} />

        <SEO
            title={title}
            description={description}
            canonical={canonicalURL.toString()}
            image={image}
            article={article}
            publishedTime={publishedTime}
            tags={tags}
        />

        <!-- Load theme script -->
        <script is:inline>
            const getThemePreference = () => {
                if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
                    return localStorage.getItem('theme');
                }
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            };

            const isDarkPreferred = getThemePreference() === 'dark';
            document.documentElement.classList[isDarkPreferred ? 'add' : 'remove']('dark');

            if (typeof localStorage !== 'undefined') {
                const observer = new MutationObserver(() => {
                    const isDarkTheme = document.documentElement.classList.contains('dark');
                    localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
                });

                observer.observe(document.documentElement, {
                    attributes: true,
                    attributeFilter: ['class'],
                });
            }
        </script>
    </head>

    <body class="bg-primary-100/30 dark:bg-secondary-500 text-gray-900 dark:text-gray-100 transition-colors">
        <div class="flex flex-col min-h-screen">
            <Header />
            <MobileNav />
            <div class="flex flex-1">
                <LeftSidebar />
                <main class="flex-1 overflow-x-hidden">
                    <slot />
                </main>
            </div>
        </div>
    </body>
</html>
