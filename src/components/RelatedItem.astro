---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { resolveLogo } from '../utils/imageResolvers.ts';

interface Props {
    item: CollectionEntry<'apps' | 'persons' | 'companies'>;
    collection: 'apps' | 'persons' | 'companies';
    resolved?: Record<string, any>;
}

const { item, collection, resolved } = Astro.props;

const href = `/${collection}/${item.slug}`;
const resolvedImage = resolveLogo(item.slug, item.data.logo);
---

<a
    href={href}
    class="group block py-3 rounded-lg hover:shadow-md dark:hover:shadow-lg transition-all duration-200"
>
    <div
        class="space-y-2 gap-x-2 sm:gap-x-2 lg:gap-x-2 grid grid-cols-3 grid-rows-[auto_auto_auto_auto]"
    >
        <div
            class="row-span-2 col-span-1 rounded-xl md:row-span-3 xl:row-span-2 flex items-start justify-start"
        >
            <div class="w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden">
                <Image
                    class="w-full h-full object-contain"
                    src={resolvedImage}
                    alt={item.data.title}
                    loading="eager"
                    format="webp"
                    width={96}
                    height={96}
                />
            </div>
        </div>

        <h4
            class="row-span-1 col-span-3 flex flex-col text-xs font-semibold text-gray-900 dark:text-gray-100 line-clamp-2 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors"
        >
            {item.data.title}
        </h4>
        {
            resolved && (
                <div class="row-span-2 col-span-3 text-xs text-gray-600 dark:text-gray-400 line-clamp-1">
                    <span class="text-gray-500 dark:text-gray-500">by </span>
                    <span class="font-medium">{resolved.author?.data?.name}</span>
                </div>
            )
        }

        <div class="col-span-3 justify-center gap-1">
            <div class="flex flex-wrap gap-1">
                <span
                    class="text-xs px-2 py-0.5 rounded-full bg-black dark:bg-white text-white dark:text-black"
                >
                    {item.data.source === 'openSource' ? 'Open Source' : 'Closed Source'}
                </span>
                <span
                    class="text-xs px-2 py-0.5 rounded-full bg-black dark:bg-white text-white dark:text-black"
                >
                    {item.data.paid ? 'Paid' : 'Free'}
                </span>
            </div>
        </div>

        {
            item.data.tags.length > 0 && (
                <div class="col-span-3 flex flex-wrap gap-1">
                    {item.data.tags.slice(0, 2).map((tag: string) => (
                        <span class="text-xs px-2 py-0.5 rounded-full bg-primary-600 dark:bg-primary-300 text-white dark:text-black hover:bg-primary-700 dark:hover:bg-primary-200">
                            {tag}
                        </span>
                    ))}
                    {item.data.tags.length > 2 && (
                        <span class="text-xs px-2 py-0.5 text-gray-500 dark:text-gray-400">
                            +{item.data.tags.length - 2}
                        </span>
                    )}
                </div>
            )
        }
    </div>
</a>
