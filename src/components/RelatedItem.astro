---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { resolveLogo } from '../utils/imageResolvers.ts';

interface Props {
    item: CollectionEntry<'apps' | 'persons' | 'companies'>;
    collection: 'apps' | 'persons' | 'companies';
}

const { item, collection } = Astro.props;

const href = `/${collection}/${item.slug}`;
const resolvedImage = resolveLogo(item.slug, item.data.logo);
// const primaryAuthor = item.data.authors.length > 0 ? item.data.authors[0] : null;
---

<a
    href={href}
    class="group block py-3 rounded-lg hover:shadow-md dark:hover:shadow-lg transition-all duration-200"
>
    <div class="space-y-2 gap-x-2 grid grid-cols-3 grid-rows-[auto_auto_auto_auto]">
        <div class="row-span-2 col-span-1 rounded-xl md:row-span-3 xl:row-span-2 flex items-start justify-start">
            <div class="w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden">
                <Image
                    class="w-full h-full object-contain"
                    src={resolvedImage}
                    alt={item.data.title}
                    loading="eager"
                    format="webp"
                    width={96}
                    height={96}
                />
            </div>
        </div>

        <h4
            class="row-span-1 col-span-2 flex flex-col text-xs font-semibold text-gray-900 dark:text-gray-100 line-clamp-2 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors"
        >
            {item.data.title}
        </h4>
        <!-- {
            primaryAuthor && (
                <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 line-clamp-1 min-w-0">
                    <span class="text-gray-500 dark:text-gray-500">by </span>
                    {primaryAuthor.data.name}
                </div>
            )
        } -->

        <div
            class="col-span-3 justify-center gap-1"
        >
        <div class="flex flex-wrap gap-1">
            <span
                class={`text-xs px-2 py-0.5 rounded-full ${
                    item.data.source === 'openSource'
                        ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'
                        : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300'
                }`}
            >
                {item.data.source === 'openSource' ? 'Open Source' : 'Closed Source'}
            </span>
            <span
                class={`text-xs px-2 py-0.5 rounded-full ${
                    item.data.paid
                        ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'
                        : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'
                }`}
            >
                {item.data.paid ? 'Paid' : 'Free'}
            </span></div>
        </div>

        {
            item.data.tags.length > 0 && (
                <div class="col-span-3 flex flex-wrap gap-1">
                    {item.data.tags.slice(0, 2).map((tag: string) => (
                        <span class="text-xs px-2 py-0.5 rounded-full bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300">
                            {tag}
                        </span>
                    ))}
                    {item.data.tags.length > 2 && (
                        <span class="text-xs px-2 py-0.5 text-gray-500 dark:text-gray-400">
                            +{item.data.tags.length - 2}
                        </span>
                    )}
                </div>
            )
        }
    </div>
</a>
