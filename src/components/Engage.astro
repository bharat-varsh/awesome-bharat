---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

import type { Link } from '@/content/config.ts';
import addIcon from '@/assets/images/engage/add.svg';
import bugIcon from '@/assets/images/engage/bug.svg';
import fixIcon from '@/assets/images/engage/fix.svg';
import suggestIcon from '@/assets/images/engage/suggest.svg';
import defaultImage from '@/assets/images/engage/default.svg';
import instagram from '@/assets/images/engage/instagram.svg';
import reddit from '@/assets/images/engage/reddit.svg';
import telegram from '@/assets/images/engage/telegram.svg';

interface Props {
    source: string;
    repositoryLinks?: { label: string; url: string}[];
    socials?: { label: string; url: string}[];
}

const { repositoryLinks, source, socials } = Astro.props;

// Social platforms to logo mapping
const socialIconMap: Record<string, ImageMetadata> = {
    bluesky: defaultImage,
    discord: defaultImage,
    instagram,
    reddit,
    telegram,
    x: defaultImage,
    __DEFAULT: defaultImage,
};

const gitHubUrl = repositoryLinks?.find(
    (link: Link) => link.label.toLowerCase() === 'github'
)?.url;

const normalizeSocialLabel = (label: string): string => label.toLowerCase();
---

<div
    class="gap-x-4 gap-y-4 mb-6 grid grid-cols-2 gap-x-2"
>
    <!-- Contribute (Open source only) -->
    {
        source === 'openSource' && gitHubUrl && (
            <div class="space-y-3">
                <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Contribute</h3>
                <div class="flex flex-wrap gap-3">
                    <a
                        href={`${gitHubUrl}/issues?q=is%3Aissue%20state%3Aopen%20(no%3Alabel%20OR%20label%3Adocumentation%20OR%20label%3Aenhancement%20OR%20label%3A%22good%20first%20issue%22%20OR%20label%3A%22help%20wanted%22%20OR%20label%3A%22high%20priority%22)`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="hover:scale-110 p-3 group relative inline-flex items-center justify-center rounded-lg transition-all transition-transform duration-300 shadow-lg shadow-primary-500/60 dark:shadow-primary-600/50"
                    >
                        <Image
                            class="relative w-4 h-4"
                            src={addIcon}
                            alt="Add a feature"
                            format="webp"
                            widths={[140, 160, 180, 200, 220]}
                            aspectRatio="1/1"
                            sizes="(min-width:1024px) 200px, (min-width:640px) 180px, 160px"
                        />
                    </a>
                    <a
                        href={`${gitHubUrl}/issues?q=is%3Aissue%20state%3Aopen%20(no%3Alabel%20OR%20label%3Adocumentation%20OR%20label%3Aenhancement%20OR%20label%3A%22good%20first%20issue%22%20OR%20label%3A%22help%20wanted%22%20OR%20label%3A%22high%20priority%22)`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="hover:scale-110 p-3 group relative inline-flex items-center justify-center rounded-lg transition-all transition-transform duration-300 shadow-lg shadow-primary-500/60 dark:shadow-primary-600/50"
                    >
                        <Image
                            class="relative w-4 h-4"
                            src={fixIcon}
                            alt="Fix an issue"
                            format="webp"
                            widths={[140, 160, 180, 200, 220]}
                            aspectRatio="1/1"
                            sizes="(min-width:1024px) 200px, (min-width:640px) 180px, 160px"
                        />
                    </a>
                    <a
                        href={`${gitHubUrl}/issues?q=is%3Aissue%20state%3Aopen%20(no%3Alabel%20OR%20label%3Adocumentation%20OR%20label%3Aenhancement%20OR%20label%3A%22good%20first%20issue%22%20OR%20label%3A%22help%20wanted%22%20OR%20label%3A%22high%20priority%22)`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="hover:scale-110 p-3 group relative inline-flex items-center justify-center rounded-lg transition-all transition-transform duration-300 shadow-lg shadow-primary-500/60 dark:shadow-primary-600/50"
                    >
                        <Image
                            class="relative w-4 h-4"
                            src={suggestIcon}
                            alt="Suggest a feature"
                            format="webp"
                            widths={[140, 160, 180, 200, 220]}
                            aspectRatio="1/1"
                            sizes="(min-width:1024px) 200px, (min-width:640px) 180px, 160px"
                        />
                    </a>
                    <a
                        href={`${gitHubUrl}/issues?q=is%3Aissue%20state%3Aopen%20(no%3Alabel%20OR%20label%3Adocumentation%20OR%20label%3Aenhancement%20OR%20label%3A%22good%20first%20issue%22%20OR%20label%3A%22help%20wanted%22%20OR%20label%3A%22high%20priority%22)`}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="hover:scale-110 p-3 group relative inline-flex items-center justify-center rounded-lg transition-all transition-transform duration-300 shadow-lg shadow-primary-500/60 dark:shadow-primary-600/50"
                    >
                        <Image
                            class="relative w-4 h-4"
                            src={bugIcon}
                            alt="Report a bug"
                            format="webp"
                            widths={[140, 160, 180, 200, 220]}
                            aspectRatio="1/1"
                            sizes="(min-width:1024px) 200px, (min-width:640px) 180px, 160px"
                        />
                    </a>
                </div>
            </div>
        )
    }

    <!-- Interact section -->
    {
        socials && socials.length > 0 && (
            <div class="space-y-3">
                <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Interact</h3>
                <div class="flex flex-wrap gap-2 justify-start">
                    {socials.map((social: Link) => {
                        const iconKey = normalizeSocialLabel(social.label);
                        const iconPath = socialIconMap[iconKey] || socialIconMap['__DEFAULT'];

                        return (
                            <a
                                href={social.url}
                                target="_blank"
                                rel="noopener noreferrer"
                                title={social.label}
                                class="hover:scale-110 inline-flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 shadow-lg shadow-primary-500/60 dark:shadow-primary-600/50"
                            >
                                <Image
                                    class="w-full h-full object-contain"
                                    src={iconPath}
                                    alt={social.label}
                                    format="webp"
                                    widths={[140, 160, 180, 200, 220]}
                                    aspectRatio="1/1"
                                    sizes="(min-width:1024px) 200px, (min-width:640px) 180px, 160px"
                                />
                            </a>
                        );
                    })}
                </div>
            </div>
        )
    }
</div>
